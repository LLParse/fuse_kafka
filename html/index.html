<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>fuse_kafka: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fuse_kafka_logo_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">fuse_kafka
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fuse_kafka Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/yazgoo/fuse_kafka">![Build Status](https://travis-ci.org/yazgoo/fuse_kafka.svg?branch=master)</a> <a href="https://coveralls.io/r/yazgoo/fuse_kafka?branch=master">![Coverage Status](https://img.shields.io/coveralls/yazgoo/fuse_kafka.svg)</a> <a href="https://gitter.im/yazgoo/fuse_kafka?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge">![Gitter](https://badges.gitter.im/Join Chat.svg)</a></p>
<div class="image">
<img src="https://raw.githubusercontent.com/yazgoo/fuse_kafka/master/graphics/fuse_kafka_logo.png"  alt="fuse kafka logo" title="Logo"/>
</div>
<p>Intercepts all writes to specified directories and send them to apache kafka brokers. Quite suited for log centralization.</p>
<h1>Installing </h1>
<p>Packages for various distros can be installed from <a href="http://download.opensuse.org/repositories/home:/yazgoo/">these repositories</a> at <a href="https://build.opensuse.org/package/show/home:yazgoo/fuse_kafka">openSUSE Build Service</a>.</p>
<p>The following should install the new repositories then install fuse_kafka: </p>
<pre class="fragment"># curl -O \
    https://raw.githubusercontent.com/yazgoo/fuse_kafka/master/setup_packages.sh \
    &amp;&amp; md5sum -c &lt;(echo "a9c81807fa1f84018f90bbd80e987863  setup_packages.sh") \
    &amp;&amp; chmod +x setup_packages.sh &amp;&amp; ./setup_packages.sh
</pre><h1>Configuration </h1>
<p>A default configuration file is available in conf/fuse_kafka.properties. An explanation for each parameter is available in this file. The packages should install it in /etc/fuse_kafka.conf.</p>
<h1>Quickstart (from sources) </h1>
<p>If you want to test fuse_kafka, using a clone of this repository.</p>
<p>First, build it: </p>
<pre class="fragment">$ ./build.py
</pre><p>On another terminal session, start zookeeper (this will download kafka): </p>
<pre class="fragment">$ ./build.py zookeeper_start
</pre><p>On another one, start kafka: </p>
<pre class="fragment">$ ./build.py kafka_start
</pre><p>The default configuration is conf/fuse_kafka.properties. An important piece of configuration is fuse_kafka_directories: </p>
<pre class="fragment">$ grep fuse_kafka_directories conf/fuse_kafka.properties -B2
# directories fuse_kafka will listen to (launch script will try to
# create them if they don't exist)
fuse_kafka_directories=["/tmp/fuse-kafka-test"]
</pre><p>Start fuse_kafka using the init script: </p>
<pre class="fragment">$ src/fuse_kafka.py start
</pre><p>If you're not running as root, you might have to make /etc/fuse.conf readable by your user (here to all users): </p>
<pre class="fragment">$ chmod a+r /etc/fuse.conf
</pre><p>And allow non-root user to specify the allow_other option, by adding a line with user_allow_other in /etc/fuse.conf.</p>
<p>If fuse_kafka is running, you should get the following output when running: </p>
<pre class="fragment">$ src/fuse_kafka.py status
listening on /tmp/fuse-kafka-test
fuse kafka is running
</pre><p>In yet another terminal, start a test consumer: </p>
<pre class="fragment">$ ./build.py kafka_consumer_start
</pre><p>Then start writing to a file under the overlay directory: </p>
<pre class="fragment">$ bash -c 'echo "foo"' &gt; /tmp/fuse-kafka-test/bar
</pre><p>You should have an output from the consumer similar to this: </p>
<pre class="fragment">event:
    group: users
    uid: 1497
    @tags:
        -  test
    @fields:
         hostname: test
    @timestamp: 2014-10-03T09:07:04.000+0000
    pid: 6485
    gid: 604
    command: bash -c echo "foo"
    @message: foo
    path: /tmp/fuse-kafka-test/bar
    @version: 0.1.3
    user: yazgoo
</pre><p>When you're done, you can stop fuse_kafka: </p>
<pre class="fragment">$ src/fuse_kafka.py stop
</pre><h1>Quota option test </h1>
<p>First, commment fuse_kafka_quota in conf/fuse_kafka.properties. Then, start fuse kafka. </p>
<pre class="fragment">$ src/fuse_kafka.py start
</pre><p>Let's create a segfaulting program: </p>
<pre class="fragment">$ cat first.c
int main(void)
{
    *((int*)0) = 1;
}

$ gcc first.c
</pre><p>Then start a test consumer, displaying only the path and message_size-added fields</p>
<p>Launch the segfaulting program in fuse-kafka-test directory: </p>
<pre class="fragment">$ /path/to/a.out
</pre><p>A new core file should appear in fused directory.</p>
<p>Here is the consumer output: </p>
<pre class="fragment">$ SELECT="message_size-added path" ./build.py kafka_consumer_start
event:
    message_size-added: 4096
    path: /tmp/fuse-kafka-test/core
...
event:
    message_size-added: 4096
    path: /tmp/fuse-kafka-test/core
</pre><p>Here we see many messages.</p>
<p>Then, uncomment fuse_kafka_quota in conf/fuse_kafka.properties and launch the segfaulting program, </p>
<pre class="fragment">$ SELECT="message_size-added path" ./build.py kafka_consumer_start
event:
    message_size-added: 64
    path: /tmp/fuse-kafka-test/core
</pre><p>This time, we only receive the first write.</p>
<h1>Event format </h1>
<p>We use a logstash event, except the message and command are base64 encoded: </p>
<pre class="fragment">{"path": "/var/log/redis_6380.log", "pid": 1262, "uid": 0, "gid": 0,
"@message": "aGVsbG8gd29ybGQ=",
"@timestamp": "2014-09-11T14:19:09.000+0000","user": "root", "group":
"root",
"command": "L3Vzci9sb2NhbC9iaW4vcmVkaXMtc2VydmVyIC",
"@version": "0.1.2",
"@fields": {
    "first_field": "first_value",
    "second_field": "second_value" },
"@tags": ["mytag"]}
</pre><h1>Installing from sources </h1>
<pre class="fragment"># installing prerequisites
$ sudo apt-get install librdkafka-dev libfuse-dev
# building
$ ./build.py 
# testing
$ ./build.py dotest
# cleaning
$ ./build.py clean
# installing:
$ ./build.py install</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 30 2014 10:59:22 for fuse_kafka by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
